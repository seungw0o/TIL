# 브라우저의 렌더링 과정

> DOM TREE와 CSSOM TREE가 합쳐져서 RENDER TREE를 만든다.
> <br />
> RENDER TREE는 Layout과 painting으로 구성되어 있다.

### HTML 파싱 - DOM (Document Object Model) 생성

- 사용자가 웹페이지 주소를 브라우저에 입력하면, 그 주소에 저장되어 있는 html 파일을 브라우저로 전송하게 된다. 이때 전송 받은 html 파일은 8비트 형태로 전송 되게 되는데, 이를 **바이트 스트림**이라고 한다.

- 브라우저는 8비트로 받은 html 파일을 문자로 변환한다. 그리고 변환한 문자를 가지고 있는 토큰과 비교한다. 이 작업을 **토큰화**라고 한다.

- 토큰화를 하면서 **노드**가 생성이 되는데 이 노드들은 DOM TREE를 구성하는 하나의 작은 요소를 의미한다.

- 노드들이 모여 트리 구조를 이루게 되는데 이것을 **DOM TREE**라고 한다.

- 브라우저가 DOM TREE를 생성할 때, 즉 DOM TREE 렌더링 과정에서 img나 link, video 같은 노드들을 만나면 다운로드를 받게 된다. script는 조금 다른데 script 노드를 만나면 script 노드 안의 js 코드를 해석하는 동안 **DOM TREE 렌더링 과정이 멈추게 된다**.

### CSS 파싱 - CSSOM (CSS Object Model) 생성

- HTML 파싱 과정과 같이, css 코드를 **바이트**로 받고 이를 **문자로 변환**하며 **토큰화** 시키고 **노드를 생성**한 뒤, **CSSOM을 생성**하게 된다.

### RENDER TREE 생성

- DOM TREE와 CSSOM TREE를 합쳐서 RENDER TREE를 생성하게 된다. 이를 크게 **Layout 단계**라고 한다.

  - Layout 단계에서는 앞서 만들어진 DOM과 CSSOM의 스타일을 따라가면서 요소의 크기나 좌표를 담은 Layout TREE를 생성하게 된다. **쉽게 말하면 요소의 위치나 크기를 만드는 단계이다.**
  - 텍스트나 요소를 숨기기 위해, **display : none;** 같은 요소를 사용하면 이 요소는 **Layout TREE에 표시되지 않게 되어서** 화면을 인식하는 **스크린 로더** 같은 프로그램이 **display : none;** 속성이 적용된 요소를 **인식 할 수 없는 문제가 발생**하게 된다.

- Layout 단계가 끝나면 **Paint 단계**가 시작된다.

  - Paint 단계에서는 앞서 만들어진 Layout TREE를 따라서 **Paint 기록**이 남게 되는데 이 **Paint 기록**에는 요소를 **렌더링 하는 순서**와 지금까지의 **정보를 바탕**으로 한 페이지를 여러 레이어로 나눈 다음 텍스트, 색, 이미지, 보더, 그림자 등 **모든 시각적인 요소를 추가**하게 된다.

- 위 단계를 모두 거치고 나면 **Composite 단계**가 실행 된다.

  - Composite 단계는 Paint 단계 때, 만들어진 **여러 레이어를 픽셀로 표현**하고, 나누어져 있던 **레이어들을 하나로 합쳐 페이지를 만든다**.

- **DOM TREE와 CSSOM TREE를 수정**하면, Layout 단계를 다시 실행하는 **리플로우 단계**와, Paint 단계를 다시 실행하는 **리페인트 단계**가 실행되게 된다.
  - **리플로우 단계와 리페인트 단계는 반드시 순차적으로 이루어지지 않는다** 그리고 **리플로우 단계는 생략**되고 **리페인트 단계만 실행되는 경우**도 있다, 이 경우는 **변경 내용이 레이아웃에 영향이 없는 것인 경우**를 말한다.
